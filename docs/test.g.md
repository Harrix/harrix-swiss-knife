---
author: Anton Sergienko
author-email: anton.b.sergienko@gmail.com
lang: en
---

# üìÑ File `test.py`

<details>
<summary>üìñ Contents ‚¨áÔ∏è</summary>

## Contents

- [üîß Function `analyze_categories`](#-function-analyze_categories)
- [üîß Function `generate_insert_commands`](#-function-generate_insert_commands)
- [üîß Function `main`](#-function-main)
- [üîß Function `parse_data_file`](#-function-parse_data_file)

</details>

## üîß Function `analyze_categories`

```python
def analyze_categories(transactions)
```

–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏

<details>
<summary>Code:</summary>

```python
def analyze_categories(transactions):
    category_counts = {}
    for trans in transactions:
        cat_id = trans["category_id"]
        category_counts[cat_id] = category_counts.get(cat_id, 0) + 1

    print("\n–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:")
    category_names = {
        2: "Food",
        3: "Transport",
        8: "Pet Care",
        13: "Healthcare",
        10: "Household Goods",
        26: "Miscellaneous",
    }

    for cat_id, count in sorted(category_counts.items()):
        cat_name = category_names.get(cat_id, f"Category {cat_id}")
        print(f"  {cat_name} (ID: {cat_id}): {count} –∑–∞–ø–∏—Å–µ–π")
```

</details>

## üîß Function `generate_insert_commands`

```python
def generate_insert_commands(transactions, batch_size = 5000, output_filename = "transactions_insert.sql")
```

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç INSERT –∫–æ–º–∞–Ω–¥—ã –±–∞—Ç—á–∞–º–∏ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª

<details>
<summary>Code:</summary>

```python
def generate_insert_commands(transactions, batch_size=5000, output_filename="transactions_insert.sql"):

    total_batches = (len(transactions) + batch_size - 1) // batch_size

    with open(output_filename, "w", encoding="utf-8") as file:
        file.write("-- Transactions INSERT commands\n")
        file.write(f"-- Total records: {len(transactions)}\n")
        file.write(f"-- Total batches: {total_batches}\n")
        file.write("-- Generated by Python script\n\n")

        for batch_num in range(total_batches):
            start_idx = batch_num * batch_size
            end_idx = min(start_idx + batch_size, len(transactions))
            batch_transactions = transactions[start_idx:end_idx]

            file.write(f"-- Batch {batch_num + 1} of {total_batches} ({len(batch_transactions)} records)\n")
            file.write("INSERT INTO transactions (amount, description, _id_categories, _id_currencies, date) VALUES\n")

            values = []
            for transaction in batch_transactions:
                value = "({}, '{}', {}, {}, '{}')".format(
                    transaction["amount"],
                    transaction["description"].replace("'", "''"),  # –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
                    transaction["category_id"],
                    transaction["currency_id"],
                    transaction["date"],
                )
                values.append(value)

            file.write(",\n".join(values))
            file.write(";\n\n")

            print(f"–û–±—Ä–∞–±–æ—Ç–∞–Ω –±–∞—Ç—á {batch_num + 1}/{total_batches} ({len(batch_transactions)} –∑–∞–ø–∏—Å–µ–π)")

    print(f"–í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Ñ–∞–π–ª: {output_filename}")
```

</details>

## üîß Function `main`

```python
def main()
```

_No docstring provided._

<details>
<summary>Code:</summary>

```python
def main():
    # –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–∞–π–ª–∞
    transactions = parse_data_file("data.txt")

    print(f"–ù–∞–π–¥–µ–Ω–æ {len(transactions)} —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π")

    # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    analyze_categories(transactions)

    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä –ø–µ—Ä–≤—ã—Ö –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
    print("\n–ü—Ä–∏–º–µ—Ä –ø–µ—Ä–≤—ã—Ö 5 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:")
    for i, trans in enumerate(transactions[:5]):
        print(f"{i + 1}. {trans}")

    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º INSERT –∫–æ–º–∞–Ω–¥—ã –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
    generate_insert_commands(transactions, batch_size=5000, output_filename="transactions_insert.sql")

    print(f"\n–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!")
```

</details>

## üîß Function `parse_data_file`

```python
def parse_data_file(filename)
```

–ü–∞—Ä—Å–∏—Ç —Ñ–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

<details>
<summary>Code:</summary>

```python
def parse_data_file(filename):
    transactions = []

    # –ü–æ–ª–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ —Ç–∏–ø–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞ –≤ ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ –ë–î
    category_mapping = {
        "Food": 2,  # Food -> expense
        "Transport": 3,  # Transport -> expense
        "Pet Care": 8,  # Pet Care
        "Healthcare": 13,  # Healthcare
        "Household Goods": 10,  # Household Goods
        "Utilities": 5,  # Utilities
        "IT": 6,  # IT
        "Repayment/Debt": 7,  # Repayment/Debt
        "Gifts": 9,  # Gifts
        "Cafe": 11,  # Cafe
        "Clothing": 12,  # Clothing
        "Balance Correction": 14,  # Balance Correction
        "Furniture": 15,  # Furniture
        "Tickets": 16,  # Tickets
        "Appliances": 17,  # Appliances
        "Sports": 18,  # Sports
        "Education": 19,  # Education
        "Personal": 20,  # Personal
        "Services": 21,  # Services
        "Toys": 22,  # Toys
        "Beauty Services": 23,  # Beauty Services
        "Stationery": 24,  # Stationery
        "Books": 25,  # Books
        "Miscellaneous": 26,  # Miscellaneous
        "Hotels": 27,  # Hotels
    }

    with open(filename, "r", encoding="utf-8") as file:
        lines = file.readlines()

        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        for line in lines[1:]:
            line = line.strip()
            if not line:
                continue

            # –ü–∞—Ä—Å–∏–º —Å—Ç—Ä–æ–∫—É
            parts = line.split("\t")
            if len(parts) != 4:
                continue

            date_str = parts[0]
            item_name = parts[1]
            category_type = parts[2]
            amount_str = parts[3]

            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç YYYY-MM-DD
            try:
                date_obj = datetime.strptime(date_str, "%d.%m.%Y")
                formatted_date = date_obj.strftime("%Y-%m-%d")
            except ValueError:
                continue

            # –ò–∑–≤–ª–µ–∫–∞–µ–º —Å—É–º–º—É (—É–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª —Ä—É–±–ª—è –∏ –∑–∞–ø—è—Ç—É—é)
            amount_match = re.search(r"([\d,]+)", amount_str)
            if amount_match:
                amount_str_clean = amount_match.group(1).replace(",", ".")
                try:
                    amount = float(amount_str_clean)
                    # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –∫–æ–ø–µ–π–∫–∏ (—É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 100)
                    amount_kopecks = int(amount * 100)
                except ValueError:
                    continue
            else:
                continue

            # –ü–æ–ª—É—á–∞–µ–º ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            category_id = category_mapping.get(category_type)
            if category_id is None:
                print(f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: {category_type}")
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º Miscellaneous –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                category_id = 26

            # –°–æ–∑–¥–∞–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
            transaction = {
                "amount": amount_kopecks,
                "description": item_name,
                "category_id": category_id,
                "currency_id": 1,  # RUB
                "date": formatted_date,
            }

            transactions.append(transaction)

    return transactions
```

</details>
